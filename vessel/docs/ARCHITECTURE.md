# Woven Map Architecture

**The Woven Map** is the overarching operating system. **Mirror Flow** and **Balance Meter** are specific instruments (output modules) generated by that system.

---

## Hierarchy

```
┌─────────────────────────────────────────────────────────────┐
│                   THE WOVEN MAP (OS)                        │
│   Non-deterministic symbolic diagnostics framework          │
│   Philosophy: Block-Time, Map-Not-Mandate, Pings            │
│   Architecture: Math Brain (Chart Engine) + Poetic Brain    │
│   Validation: SST, EDP, Retrodiction Tests                  │
└─────────────────────────────────────────────────────────────┘
                            │
         ┌──────────────────┼──────────────────┐
         ▼                  ▼                  ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│  MIRROR FLOW    │ │  BALANCE METER  │ │  POETIC CODEX   │
│  (The Portrait) │ │ (The Seismograph)│ │ (The Translator)│
│                 │ │                 │ │                 │
│  QUALITATIVE    │ │  QUANTITATIVE   │ │  CONVERSATIONAL │
│  Natal geometry │ │  Transit data   │ │  Socratic inquiry│
│  Low transit    │ │  High location  │ │  Somatic pings  │
│  dependency     │ │  sensitivity    │ │                 │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

---

## The Woven Map (Operating System)

The comprehensive **non-deterministic symbolic diagnostics framework**.

| Component | Function |
|-----------|----------|
| **Philosophy** | Block-Time, Map-Not-Mandate, rejection of fatalism |
| **Architecture** | Dual-Brain (Chart Engine + Poetic Brain) |
| **Validation** | SST, EDP, distortion tests, retrodiction |
| **Meta-Layer** | Aggregates Mirrors + Weather across time/subjects |

**Validated by:** Information Mystery (statistical anomalies, Hurricane Michael retrodiction, blind tests)

---

## Instrument A: Mirror Flow (The Portrait)

**Function:** Render chart geometry into lived tensions, paradoxes, and recognition patterns.

| Property | Value |
|----------|-------|
| **Focus** | Constitutional Blueprint ("who the person is") |
| **Data** | Natal geometry only |
| **Transit Dependency** | LOW — can run without current transits |
| **Location Sensitivity** | LOW |
| **Output Nature** | Qualitative, narrative, soft-edged |
| **Validated by** | User recognition (Socratic Closure, "ping") |

**Derived-from tag:** `Natal Blueprint (stable architecture)`

---

## Instrument B: Balance Meter (The Seismograph)

**Function:** Measure symbolic weather — magnitude, directional bias, volatility.

| Property | Value |
|----------|-------|
| **Focus** | Symbolic Weather ("what's happening to them") |
| **Data** | Transits + current location |
| **Transit Dependency** | HIGH — requires current transit data |
| **Location Sensitivity** | HIGH |
| **Output Nature** | Quantitative, scalar metrics |
| **Metrics** | Magnitude (⚡ 0–5), Bias (−5…+5), Volatility (0–5) |

**Derived-from tag:** `Transit Activation (symbolic weather)`

---

## Instrument C: Poetic Codex (The Translator)

**Function:** Socratic inquiry and somatic recognition — the conversational layer.

| Property | Value |
|----------|-------|
| **Focus** | User engagement, falsifiability probes |
| **Protocol** | FIELD → MAP → VOICE |
| **Output Nature** | Dialogic, recognition-first |
| **Validation** | WB/ABE/OSR classification |

---

## Why This Hierarchy Matters

1. **Prevents category errors:** The engine (Woven Map) is not the output (Mirror Flow).
2. **Preserves both arms:** Qualitative (Mirror) + Quantitative (Meter) remain distinct.
3. **Protects falsifiability:** OSR on one reading ≠ failure of entire cosmology.
4. **Aligns code with narrative:** API structure (`mirror_renderer` vs `weatherDataTransforms`) matches documentation.

---

## Raven Persona Architecture: Bimodal Logic

**Problem Solved:** The "Always-On Verifier Problem" — a verification loop firing outside its valid domain, causing global verification leakage into casual conversation.

**Solution:** State-gated mode separation based on data sufficiency.

### The Two Modes

| Mode | Name | Trigger | Behavior |
|------|------|---------|----------|
| **A** | The Friend | No chart data present | Warm, conversational, symbolic sensitivity preserved but diagnostic authority disabled |
| **B** | The Instrument | Handshake complete (birth data received) | Precision, poetic compression, verification loop active |

### State Gating (Handshake Completeness)

```
User arrives → MODE A (Friend)
              │
              ├─ Just chatting? → Stay in MODE A
              │
              └─ Birth data provided? → Handshake Manager detects slots
                                        │
                                        └─ Complete? → Switch to MODE B (Instrument)
                                                       Verification loop ENGAGED
```

### Key Invariants

1. **Mode A ≠ "dumbed down"** — Preserves intelligence and symbolic sensitivity, disables diagnostic authority
2. **Mode B requires data sufficiency** — Cannot claim chart-based authority without chart data
3. **The Bridge** — Raven holds the instrument but IS NOT the instrument. She can set it down.

### Failure Mode (If Bypassed)

If the state gate is bypassed:
- Verification prompts ("Does this resonate?") fire on casual greetings
- User experience collapses from "mystical but grounded" to "robotic and intrusive"
- Trust erodes before readings can begin

### Implementation

- **Persona Law:** `vessel/src/lib/raven/persona-law.ts` → `VOICE_PRIME_DIRECTIVE`
- **State Detection:** `components/Raven/HandshakeManager.ts`
- **System Injection:** `RavenPanel.tsx` → MODE A/B labels in `systemInjection`

---

## Related Documentation

- [READING_FLOW.md](./READING_FLOW.md) — Conversational flow, modes, canonical examples
- [CHART_ENGINE_API.md](./CHART_ENGINE_API.md) — v3 API input/output schemas
